

# Linux Privilege Escalation 


Although Metasploit offers some privilege escalation modules for Linux OS's, the best way
to proceed is by getting information about the current OS and then searching for publicly 
available exploits


Notice that privilege escalation exploits are very OS specific, so information about the OS
and the applications installed on the machine may result in very useful information to
narrow down your search 


To get info on a linux system run the command sysinfo 


For this example we are working with a Linux Ubuntu 14.04.2 LTS (32bit) machine. Moreover,
we can see we are actually running under the name els


Our goal is to obtain the highest privileges on the machine, which in this case means
getting access as root. The most basic thing we can do, is search for a public exploit
for privesc available online 


If we search the current OS there seems to be something available for this system called 
overlayfs Local Root Shell


By opening the link we can view the source code and download it


Most of the time you will find the source code of the exploit and you will have to compile 
it

If the romote machine has everything you need you can compile the exploit directly on the 
target, otherwise you will have to compile it on your own machine. In the latter case, be
aware to use the correct configuration and select the right architecture


# Compile on the target

Let us suppose that the target machine has everything we need installed, such as gcc and we
can compile the file

What we can do is upload the source file on the target, get a shell on it through
meterpreter and then compile the exploit

In order to upload the file, we just need to use the upload command that meterpreter 
already implements. We need to provide the local path of the exploit and then the remote
path, where to upload the file

Now lets get a terminal session with the shell command and then compile the source with gcc. The compiled exploit will be named exploit. steps shown below


meterpreter > shell
Process created

$ ls 
file.c
$gcc file.c -o exploit

The last step now is to run the exploit. We can do so by simply running the command 
./exploit

Now we should be running as root


# Compile on our machine

Supposing the target machine does not have gcc, we cannot compile the exploit there and 
we have to do it locally

Since the two machines are a bit different (our OS is 64-bit and the target is 32-bit), we 
need to set gcc parameters accordingly. Notice that installing all the required packages 
is out of the scope here, you can find resources online for it


In order to compile the exploit we will use the following command: 

gcc -m32 -o linux_priv_esc file.c

Now that we have the compiled version we can upload it with our meterpreter session using
the upload command

We will also need to change the permission on the file and make it executable 

We will spawn a shell on the machine and run everything from there



