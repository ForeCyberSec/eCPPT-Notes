

# Local Enumeration 

Now that we've covered some methodology in regard to information gathering from a remote 
perspective, It's time to step into what we do once we've obtained access to a Linux 
machine


This section is a pre-cursor to the "Post-Exploitation" module of this course in the sense that 
we've gotten some type of access to a machine: 

Either as  a low priv/high priv user 

Via a shell 

Through a web application or some other means

With the ultimate goal of obtaining higher-level access to our current machine, and furthermore, 
access to other machines within an environment as a result of information obtained from our
exploited host 

During this process, we're gathering information from our exploited machine(s), and using the
information gathered to give us situational awareness that is needed to better understand and 
further exploit the environment we're in 

Often, when this phase is complete, due to the depth of information that can be obtained, we 
sometimes find ourselves understanding the systems surrounding infrestructure better than the 
administrators and engineers that built them in the first place 


The type of information we gather during this phase falls into two higher-level categories: 

Network Information 

System Information

Both involve different sets of tools and methods, but the good news is, for the most part, once 
we have access to a Linux host, most of those tools are already provided for us, The methodology 
that follows will be useful in the post-exploitation section that we'll go over later


# For network information, we can ask ourselves some important questions: 

1. How is the exploited machine connected to the network? 

2. Is the machine multi-homed? Can we pivot to other hosts in other segments? 

3. Do we have unfettered outbound connectivity to the internet or is egress traffic limited to 
certain ports and protocols? 

4. Is there a firewall between me and other devices/machines? 

5. Is the machine I'm on, communicating with other hosts? if so, what is the prupose or function of the 
hosts that my current machine is communicating with? 

6. What protocols are being using that are originating from my actively exploited machine? Are we
initiating FTP connections or other connections (SSH, etc.) to other machines? 

7. Are other machines initiating a connection with me? if so, can that traffic be intercepted or 
sniffed as cleartext in transit? is it encrypted? 


All of these questions can be answered with some standard utilites we can find on our compromised 
Linux host, in addition to some simple bash scripting 

Remember to keep a log of all the information gathered, since we will need to revisit all of our 
collected data for the post-exploitation phase 

# DNS Information 

What machine is resolving our DNS queries? 

Can we use it to exfiltrate data over a DNS tunnel? 

Is the DNS server vulnerable to any exploits? 

Is it an Active Directory controller? 

It will be important to answer all of these questions later. DNS server information is typically 
stored in /etc/resolv.conf 


# ARP Cache 


the systems ARP cache can be used to give us a bit of situational awareness regarding machines near
us, or machines that our currently exploited machine communicates with for one reason or another

This information is useful when it comes down to determining who we're communicating with, whats 
being communicated, and wether that traffic or communication has any value to us from an 
exploitation perspective I.E., credentials trasnmitted in cleartext, etc. 

arp -en


# netstat 

Netstat gives us an insight regarding: 

- What other machines or devices we are currently connected to
- Which ports or services on other machines we are connected to
- What ports our current machine is listening on 
- Are there other systems establishing connections with our current machine

We can list all TCP and UDPO connections to other systems and listening services with: 

netstat -auntp


In the rare case that youre on a very restricted machine, and the netstat command is missing, 
Etienne Stahlmans did some great research regarding parsing similar information from the 
/proc/net/tcp and /proc/net/udp files

We can explore the work done there for a better understanding of how netstat obtains its information 
with the following link 

# https://staaldraad.github.io/2017/12/20/netstat-without-netstat/



# ss 

An alternative to netstat that we can use to list active network connections is the "ss" command

"ss -twurp" comes in handy for another perspective on established connections, bytes being transferred,
and the processes/users responsible for the connections


# Outbound Port Connectivity 

Another thing we want to check is wether or not our outbound port connectivity is restricted in 
any way 

Knowing this information will come in handy if and when we need to establish outbound connections to
other systems we control for the purpose of maintaining access or exfiltrating data

A quick way we can check outbound port connectivity status is with portquiz.net, 
Portquiz.net is a web server which has most (if not all) TCP ports listening. We can use it to 
confirm we can connect to any arbitrary ports outside of our network with a quick nmap scan: 

## nmap -sT -p 4444-4450 portquiz.net


Keep in mind that any scans originating from your compromised machine can alert network administrators
of anomalous activity. Consider using nmap's --T (timing) option at a low value to stay under any 
internal IDS radar





# System Information gathering


The system information gathering phase is similar to the network information phase, except we're 
getting much more data. Our goal with this phase is to get information rgarding: 

- Operating System and Kernal
- Environment Variables
- Interesting Files and Sensitive Information 
- Users, groups, Permissions and Privileges 
- Services and Associated Configuration Files 
- Cron Jobs, System Tasks
- Installed Applications and Versions 
- Running Processes

Our ultimate goal from this portion of testing is to elevate our privileges once we've obtained 
access to a system or systems and obtain additional footholds within an environment as a result 
of the information we obtain 

Rather than go into specifics in this section on every command we can use to gather critical 
information about the system (as we'll see there are many to explore), we'll provide them here 
in a list summary: 

Many of these commands will be covered in depth in the post-expoitation module

Additionally, there are several great tools and other resources we can use to automate the process 
of information gathering once we're on a target machine

We will cover those as well


- Current User Information: 
# id 

- kernel Version: 
# uname -a

- Current User Information from /etc/passwd
# grep $USER /etc/passwd

- Most Recent Logins
# lastlog

- Who is currently logged onto the system
# w

- Last Logged On Users
# last

- All Users Including UID and GID Information 
# for user in $(cat /etc/passwd | cut -f1 -d":"); do id $user; done

- List all UID 0 (root) accounts
# cat /etc/passwd |cut -f1,3,4 -d":"); |grep "0:0" |cut -f1 -d":" |awk '{print $1}' 

- Read passwd File
# cat /etc/passwd

- Check readability of the shadow file
# cat /etc/shadow

- What can we sudo without a password? 
# sudo -l

- Can we read the /etc/sudoers file? 
# cat /etc/sudoers

- Can we read the roots .bash_history file? 
# cat /root/.bash_history

- Can we read any other users' .bash_history files? 
# find /home/* -name *.*history* -print 2> /dev/null

- Operating System
# cat /etc/issue
# cat /etc/*-release

- Can we sudo known binaries that allow breaking out into a shell? 
# sudo -l |grep vim
# sudo -l |grep nmap
# sudo -l |grep vi

- Can we list root's home directory? 
# ls -als /root/

- Current $PATH environment variable
# echo $PATH

- List all cron jobs
# cat /etc/crontab && ls -als /etc/cron*

- Find world-writeable cron jobs
# find /etc/cron* -type f -perm -o+w -exec ls -l {} \;

- List running processes
# ps auxwww

- List all processes running as root
# ps -u root

- List all processes running as current user
# ps -u $USER

- Find SUID files
# find / -perm -4000 -type f 2>/dev/null

- Find SUID files owned by root
# find / -uid 0 -perm -4000 -type f 2>/dev/null

- Find GUID files
# find / -perm -2000 -type -f 2>/dev/null

- Find world-writeable files
# find -perm -2 -type f 2>/dev/null

- List all conf files in /etc/
# ls -al /etc/*.conf

- Find conf files that contain the string "pass*" 
# grep pass* /etc/*.conf

- List open files
# lsof -n

- List installed packages (Debian)
# dpkg -l

- Common software versions 
# sudo -V
# httpd -v
# apache2 -v
# mysql -V
# sendmail -d0.1

- Print process binaries/paths and permissions
# ps aux | awk '{print $11}' |xargs -r ls -la 2>/dev/null |awk '!x[$0]++'



By no means are these a complete list of all commands that we can use for gathering local 
system information. There are hundreds of ways to gather the same information, and we should 
also use our imagination as to what we should be looking for and ways to elevate our privileges 
or exploit our targets

There are also countless great resources and tools we can use to accomplish these tasks more efficiently


# LinEnum

Automated information gathering tool. LinEnum captures what we've covered and much more

As we've mentioned, there are plenty of ways of getting the same information, and LinEnum 
takes care of a lot of that process
