


# Info Gathering and Recon


PowerShell is typically used for post exploitation, however, we can also use it to conduct info gathering 
and reconnaissance

There are sever third-party tools, built in cmdlets, and frameworks that exist that can help us with these
tasks



One of the first steps in our pentest methodology is that of Info gathering and Recon

The idea is to be able to leverage PowerShell for many of our pentesting activities

Again, considering its availability already on systems we've compromised, its ease of use and
capabilities, or simply because the customer would like to have us perform the pentest from a 
machine that they supply


In that case it becomes useful to be able to utilize PowerShell to conduct many of our tasks when we're 
limited in regard to our toolset and unable to bring along all of the tools in our arsenal

One of the first steps is the discovery of hosts and port scans on the network we are operating on

As we saw before, we can do port scans with a one-liner like the following, without requiring any 
third party modules


PS C:\> $ports=(80,8080,443,22); $ip="1.1.1.1"; foreach ($port in $ports) {try{$socket=New-Object
System.Net.Sockets.TcpClient ($ip,$port);} catch{}; if ($socket -eq $null) {echo $ip":"$port" -
closed";}else{echo $ip":"$port" - Open"; $socket = $null;}}


The above may be useful for a targeted probe, but not in the case where we want to scan an entire
net block as it only allows for scanning of one IP address at a time




# PowerSploit - Invoke-PortScan


One tool we can use for efficient discovery of hosts on a network and is included in the PowerSploit 
framework is the Invoke-Portscan cmdlet

First we can utilize Invoke-Portscan to execute a ping scan (-PingOnly) against our target network range in 
CIDR notation with the -Hosts parameter in an attempt to identify live hosts


PS C:\> Invoke-Portscan -Hosts "1.1.1.0/24" -PingOnly


We can also supply a file containing a list of IP addresses with the -HostFile parameter. The results of
which will show "True" for live hosts. Also to save results we can pipe it to the Export-Csv cmdlet like
shown below

PS C:\> Invoke-Portscan -HostFile ips.txt -PingOnly |Export-Csv C:\ping_scan.csv



Once we've identified live hosts, we can then conduct port scans using the -ports parameter like the example
below

Invoke-Portscan -HostFile live_hosts.txt -ports "53-81"



Another useful feature is the ability to output in a greppable ".gnmap" Nmap format with the -oG and -f 
parameters


PS C:\> Invoke-Portscan -HostFile live_hosts.txt -oG port_scan.gnmap -f -ports "1-81"




# PowerSploit - Get-HttpStatus

For a tool similiar to what we're used to for enumerating files and directories on web servers, i.e.,
dirsearch, dirb, etc., we can use PowerSploit's Get-HttpStatus command


Get-HttpStatus works in conjunction with a dictionary (-Path), like other similiar tools, and when used 
in conjunction with the Where-Object alias (?) will return a list of pages or directories on the web server

//the space after the underscore is to avoid italics in markdown
PS C:\> Get-HttpStatus -Target 1.1.1.1 -Path dictionary.txt -port 80 | >> ? {$_ .Status -match "ok"}


# Posh-SecMod - Invoke-ARPScan

Another useful cmdlet we can use for host discovery that is part of Carlos Perez's Posh-SecMod framework, is
Invoke-ARPScan and may generate fewer alerts than your usual SYN or TCP scan

PS C:\> Invoke-ARPScan -CIDR 1.1.1.1


Posh-SecMod has several useful cmdlets we can use for host discovery purposes among others which can be 
shown with the following command

PS C:\> Get-Command -Module Posh-SecMod


For reverse DNS lookups, we can use Posh-SecMod's Invoke-ReverseDNSLookup cmdlet against a target CIDR block


PS C:\> Invoke-ReverseDNSLookup CIDR 1.1.1.0/24


A couple of other DNS-related cmdlets within Posh-SecMod that are also useful for enumerating DNS are
Resolve-HostRecord and Resolve-DNSRecord 

PS C:\> Get-Help Resolve-HostRecord -Examples


