

# Enumerating NFS


Please note that since NFS is an RPC-based service and relies on other RPC services, such as 
"mountd", it should be directly queried via the Portmapper service which is found on port TCP
and/or UDP 111 when using nmap NSE scripts for instance 

We'll cover Portmapper services shortly

An administrator wishing to share files from an NFS server will configure what are known as 
"exports". Exports are the mechanism used by NFS in order to "export" directories, in other 
words, make entire directories available to other users over the network 

Exports configured for any given NFS server can usually be found in the "etc/exports" file on a
target host locally. For now, we're going to focus on identifying available exports from a remote 
perspective 

One common issue with NFS, is that administrators will usually "export" directories with little
attention to security, and will usually export directories in a manner that allows any host 
or IP to connect, without any authentication, and if we're lucky, also provide write-access to
directories

Once we've identified that a server is running NFS, the first thing we want to do is query it 
with several nmap NSE scripts. Specifically, "nfs-ls", "nfs-showmount" and "nfs-statfs"

We can find some NSE scripts we can use for NFS with a simple command: 

## ls usr/share/nmap/scripts/ | grep nfs



We can then use a command similar to the following to obtain results relevant to NFS: 

## nmap --script nfs-ls,nfs-showmount,nfs-statfs <targetIP>


Example return output from the above command shown in folder


Alternatively we can use the built in "showmount" command with the -e or --exports switches 
to show any exports that would be available to us as well 

However, we can see it wont return as much information as the previous nmap command, as its 
designed to simply list any available exports: 

## showmount -e <targetIP> 



In the previous two examples, we can see that our tools identified two exported directories,
followed by a "*" value, which allows mounting the exports from any IP address or host. This 
configuration is often catastrophic

Ideally an admin would want to explicitly define (whitelist) IP addresses or hosts that should 
be allowed to connect to the NFS server, in which case, the output would be something similar to: 

Export list for <IP>: 
var/www admin.foocampus.com 192.168.13.100  <--- Whitelisted IP 
/home/bob 192.168.13.129                    <--- Adresses/Hosts


Even in the case that our access is restricted due to an NFS whitelist config like shown above, 
the output would still give us valuable information regarding which IP addresses or hosts can 
mount any available exports

In this scenario, that information would be useful in the case we can either spoof our IP address to
match a whitelisted IP address or take control of a host which is allowed to connect


Once we've gathered the relevant information and have confirmed a misconfiguration, we can attempt
to mount the available exported directories; this can be accomplished by first creating a temporary
directory as your mount point: 

## mkdir -p /mnt/home/bob

Then the exported NFS directory can be mounted with the following command: 

## mount -t nfs <NFS server IP>:/home/bob /mnt/home/bob - nolock

We can confirm that the previous commands were successful by viewing our currently mounted file 
systems and confirming that our NFS mount exists by just running the "mount" command without any 
arguments (example shown in folder)


